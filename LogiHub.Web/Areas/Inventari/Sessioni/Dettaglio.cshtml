@model LogiHub.Web.Areas.Inventari.Sessioni.DettaglioSessioneViewModel

@{
    ViewData["Title"] = "Inventario - " + Model.NomeSessione;
}

<div>
    @await Html.PartialAsync("~/Features/SearchCard/_SearchCardSimple.cshtml", Model.SearchCard)
</div>

<div class="card shadow-sm mt-3">
    <div class="card-body p-1">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4" style="width: 30%;">Ubicazione</th>
                        <th class="text-center" style="width: 20%;">Stato</th>
                        <th>Info / Azioni</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var ubiDaFare = Model.UbicazioniFiltrate.Where(u => !u.Completata && !u.InLavorazione);
                        var ubiInLavorazione = Model.UbicazioniFiltrate.Where(u => u.InLavorazione);
                        var ubiCompletate = Model.UbicazioniFiltrate.Where(u => u.Completata);
                    }

                    @if (ubiDaFare.Any())
                    {
                        <tr class="table-secondary">
                            <td colspan="3" class="ps-4 fw-semibold text-muted small uppercase">Da Fare</td>
                        </tr>
                        @foreach (var ubi in ubiDaFare)
                        {
                            <tr>
                                <td class="ps-4">
                                    <a href="@Url.Action("RilevamentoUbicazione", new { sessioneId = Model.SessioneId, ubicazioneId = ubi.UbicazioneId })" class="text-decoration-none fw-bold">
                                        @ubi.Posizione
                                    </a>
                                </td>
                                <td class="text-center">
                                    <span class="badge rounded-pill bg-light text-dark border">In attesa</span>
                                </td>
                                <td>
                                    <a href="@Url.Action("RilevamentoUbicazione", new { sessioneId = Model.SessioneId, ubicazioneId = ubi.UbicazioneId })" class="btn btn-sm btn-outline-primary">
                                        Inizia <i class="fa-solid fa-play ms-1"></i>
                                    </a>
                                </td>
                            </tr>
                        }
                    }

                    @if (ubiInLavorazione.Any())
                    {
                        <tr class="table-secondary">
                            <td colspan="3" class="ps-4 fw-semibold text-muted small uppercase">In Lavorazione</td>
                        </tr>
                        @foreach (var ubi in ubiInLavorazione)
                        {
                            <tr class="table-warning">
                                <td class="ps-4">
                                    <a href="@Url.Action("RilevamentoUbicazione", new { sessioneId = Model.SessioneId, ubicazioneId = ubi.UbicazioneId })" class="text-decoration-none fw-bold text-dark">
                                        @ubi.Posizione
                                    </a>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-warning text-dark">Occupato</span>
                                </td>
                                <td>
                                    <small class="text-dark"><i class="fa-solid fa-user me-1"></i> @ubi.OperatoreCorrente</small>
                                </td>
                            </tr>
                        }
                    }

                    @if (ubiCompletate.Any())
                    {
                        <tr class="table-secondary">
                            <td colspan="3" class="ps-4 fw-semibold text-muted small uppercase">Completati</td>
                        </tr>
                        @foreach (var ubi in ubiCompletate)
                        {
                            <tr class="bg-light">
                                <td class="ps-4 text-muted">@ubi.Posizione</td>
                                <td class="text-center">
                                    <span class="badge bg-success">Completato</span>
                                </td>
                                <td>
                                    <small class="text-muted">Finito da: @ubi.OperatoreCorrente</small>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
